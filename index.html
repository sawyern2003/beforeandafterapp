<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Create professional before-and-after images for clinics instantly. Stop wasting time in Canva with our branded, compliant image generator.">
    <meta name="keywords" content="before after, clinic images, medical marketing, aesthetic clinic, image generator">
    <meta name="author" content="Before & After Pro">
    <meta property="og:title" content="Before & After Pro | Instant, Branded Images for Clinics">
    <meta property="og:description" content="Create stunning, branded, and compliant before-and-after photos for your clinic in seconds.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta name="twitter:card" content="summary_large_image">
    <title>Before & After Pro | Instant, Branded Images for Clinics</title>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"></noscript>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì∏</text></svg>">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">
</head>
<body class="bg-slate-50 text-slate-800">
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-indigo-600 text-white px-4 py-2 rounded-lg z-50">Skip to main content</a>

    <!-- Upgrade Button -->
    <div class="fixed right-4 top-4 z-50 flex gap-2 items-center">
        <button id="plan-pill" class="px-3 py-1 rounded-full text-xs font-semibold bg-slate-200 text-slate-700" aria-label="Current plan"></button>
        <button id="upgrade-btn" onclick="window.open('https://buy.stripe.com/7sY28tbfjfVj8Kt3V90x200', '_blank')" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg shadow transition-colors">
         Upgrade to Pro (¬£29/mo)
        </button>
    </div>

    <div class="w-full max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header Section -->
        <header class="text-center py-16 md:py-20">
            <div class="flex justify-center items-center gap-3 mb-4">
                <svg class="h-10 w-10 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.776 48.776 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
                </svg>
                <h1 class="font-bold text-3xl text-slate-900">Before & After Pro</h1>
            </div>
            <h2 class="text-4xl md:text-5xl font-extrabold text-slate-900 leading-tight">
                The Fastest Way to Create Professional Before & Afters
            </h2>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">
                Stop wasting time in Canva. Create stunning, branded, and compliant before-and-after photos for your clinic in seconds.
            </p>
        </header>

        <!-- Main App Section -->
        <main id="main-content" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Step 1: Controls -->
            <section class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                <h3 class="text-xl font-semibold mb-4 border-b pb-2">Controls</h3>
                
                <!-- Format Selection -->
                <div class="mb-6">
                    <h4 class="font-semibold text-slate-700 mb-2">Format</h4>
                    <div id="format-selector" class="flex justify-between gap-2 text-sm" role="radiogroup" aria-label="Image format selection">
                        <input type="radio" name="aspectRatio" value="square" id="format-square" class="hidden" checked>
                        <label for="format-square" class="format-label">Square (1:1)</label>
                        <input type="radio" name="aspectRatio" value="portrait" id="format-portrait" class="hidden">
                        <label for="format-portrait" class="format-label">Portrait (4:5)</label>
                        <input type="radio" name="aspectRatio" value="landscape" id="format-landscape" class="hidden">
                        <label for="format-landscape" class="format-label">Landscape</label>
                    </div>
                </div>

                <!-- Font Selection -->
                <div class="mb-6">
                    <h4 class="font-semibold text-slate-700 mb-2">Font</h4>
                    <select id="font-selector" class="w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500" aria-label="Select font family">
                        <option value="Inter">Inter</option>
                        <option value="Poppins">Poppins</option>
                        <option value="Montserrat">Montserrat</option>
                        <option value="Lato">Lato</option>
                        <option value="Raleway">Raleway</option>
                        <option value="Roboto">Roboto</option>
                    </select>
                </div>

                <!-- Image Uploads -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div id="before-container" class="file-input-container p-4 text-center">
                        <label for="before-upload" class="file-input-label flex flex-col items-center justify-center h-full">
                            <span class="text-indigo-600 font-semibold">Upload Before</span>
                            <span class="text-xs text-slate-500 mt-1">or drag & drop</span>
                            <img id="before-preview" class="mt-2 max-h-24 rounded hidden" alt="Before Preview"/>
                        </label>
                        <input type="file" id="before-upload" class="hidden" accept="image/*" aria-label="Upload before image">
                    </div>
                    <div id="after-container" class="file-input-container p-4 text-center">
                        <label for="after-upload" class="file-input-label flex flex-col items-center justify-center h-full">
                            <span class="text-indigo-600 font-semibold">Upload After</span>
                            <span class="text-xs text-slate-500 mt-1">or drag & drop</span>
                            <img id="after-preview" class="mt-2 max-h-24 rounded hidden" alt="After Preview"/>
                        </label>
                        <input type="file" id="after-upload" class="hidden" accept="image/*" aria-label="Upload after image">
                    </div>
                </div>
                
                <!-- Saved Presets -->
                <div id="preset-section" class="mb-6 relative">
                    <h4 class="font-semibold text-slate-700 mb-2">Saved Presets <span class="text-xs bg-indigo-100 text-indigo-700 font-medium px-2 py-1 rounded-full">PRO</span></h4>
                    <div class="mb-2 flex gap-2 items-end">
                        <div class="flex-1">
                            <label for="preset-name" class="block text-sm font-medium text-slate-600">Preset name</label>
                            <input id="preset-name" class="mt-1 w-full px-3 py-2 border rounded-md text-sm" placeholder="e.g., Oxford Clinic Default">
                        </div>
                        <button id="preset-save" class="px-3 py-2 bg-slate-800 text-white rounded-md text-sm hover:bg-slate-700 transition-colors">Save</button>
                    </div>
                     <div class="flex gap-2 items-center">
                        <select id="preset-select" class="flex-1 px-3 py-2 border rounded-md text-sm">
                            <option value="">Load preset‚Ä¶</option>
                        </select>
                        <button id="preset-delete" class="px-3 py-2 border rounded-md text-sm text-slate-600 hover:bg-slate-100 transition-colors">Delete</button>
                    </div>
                    <div class="mt-2 flex gap-2">
                        <button id="preset-export" class="px-3 py-2 border rounded-md text-sm text-slate-600 hover:bg-slate-100 transition-colors">Export preset</button>
                        <label class="px-3 py-2 border rounded-md text-sm text-slate-600 hover:bg-slate-100 cursor-pointer transition-colors">
                            Import preset
                            <input id="preset-import" type="file" accept="application/json" class="hidden">
                        </label>
                    </div>
                </div>

                <!-- Branding -->
                <div class="mb-6">
                    <h4 class="font-semibold text-slate-700 mb-2">Branding & Compliance</h4>
                    <div class="flex items-center gap-4 mb-4">
                        <div id="logo-container" class="file-input-container p-2 text-center w-1/3">
                            <label for="logo-upload" class="file-input-label text-sm">
                                <span class="font-medium text-indigo-600">Add Logo</span>
                                <img id="logo-preview" class="mt-1 max-h-12 mx-auto rounded hidden" alt="Logo Preview"/>
                            </label>
                            <input type="file" id="logo-upload" class="hidden" accept="image/*" aria-label="Upload logo">
                        </div>
                        <div class="flex-grow">
                            <label for="clinic-name" class="block text-sm font-medium text-slate-600">Clinic Name</label>
                            <input type="text" id="clinic-name" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500" placeholder="e.g., The Glow Clinic">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="treatment-name" class="block text-sm font-medium text-slate-600">Treatment Name</label>
                            <input type="text" id="treatment-name" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500" placeholder="e.g., Laser Hair Removal">
                        </div>
                        <div class="relative">
                            <label for="patient-name" class="block text-sm font-medium text-slate-600">Patient/Client Name</label>
                            <input type="text" id="patient-name" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500" placeholder="e.g., Jane Doe">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="treatment-date" class="block text-sm font-medium text-slate-600">Date of Treatment</label>
                            <input type="date" id="treatment-date" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm">
                        </div>
                        <div class="relative">
                            <label for="brand-color-text" class="block text-sm font-medium text-slate-600">Label Color</label>
                            <div class="mt-1 flex items-center gap-2">
                                <div class="relative">
                                    <span id="brand-color-preview" class="block w-8 h-8 rounded-full border border-slate-300 cursor-pointer" style="background-color: #000000;" role="button" tabindex="0" aria-label="Select label color"></span>
                                    <input type="color" id="brand-color-picker" value="#000000" class="color-picker-input" aria-label="Label color picker">
                                </div>
                                <input type="text" id="brand-color-text" value="#000000" class="block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500" placeholder="#000000">
                            </div>
                        </div>
                    </div>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="relative">
                            <label for="text-color-text" class="block text-sm font-medium text-slate-600">Text Color</label>
                            <div class="mt-1 flex items-center gap-2">
                                <div class="relative">
                                    <span id="text-color-preview" class="block w-8 h-8 rounded-full border border-slate-300 cursor-pointer" style="background-color: #1e293b;" role="button" tabindex="0" aria-label="Select text color"></span>
                                    <input type="color" id="text-color-picker" value="#1e293b" class="color-picker-input" aria-label="Text color picker">
                                </div>
                                <input type="text" id="text-color-text" value="#1e293b" class="block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500" placeholder="#1e293b">
                            </div>
                        </div>
                        <div class="relative">
                            <label for="box-color-text" class="block text-sm font-medium text-slate-600">Differences Box Color</label>
                            <div class="mt-1 flex items-center gap-2">
                                <div class="relative">
                                    <span id="box-color-preview" class="block w-8 h-8 rounded-full border border-slate-300 cursor-pointer" style="background-color: #000000;" role="button" tabindex="0" aria-label="Select differences box color"></span>
                                    <input type="color" id="box-color-picker" value="#000000" class="color-picker-input" aria-label="Differences box color picker">
                                </div>
                                <input type="text" id="box-color-text" value="#000000" class="block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500" placeholder="#000000">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Differences -->
                <div class="mb-6 relative">
                    <h4 class="font-semibold text-slate-700 mb-2">Key Differences (Bullet Points)</h4>
                    <textarea id="differences-text" rows="3" class="w-full p-2 border border-slate-300 rounded-md text-sm" placeholder="- Reduced redness&#10;- Smoother skin texture"></textarea>
                </div>

                <!-- Image Positioning -->
                <div class="mb-6 relative">
                    <h4 class="font-semibold text-slate-700 mb-2">Image Positioning</h4>
                    <div id="before-slider-container" class="hidden space-y-2">
                        <p class="text-sm font-medium text-slate-600">Before Image</p>
                        <div>
                            <label for="before-zoom-slider" class="block text-xs font-medium text-slate-500">Zoom</label>
                            <input type="range" id="before-zoom-slider" min="1" max="3" step="0.01" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" disabled>
                        </div>
                        <div>
                            <label for="before-x-slider" class="block text-xs font-medium text-slate-500">Left/Right</label>
                            <input type="range" id="before-x-slider" min="0" max="1" step="0.01" value="0.5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" disabled>
                        </div>
                        <div>
                            <label for="before-y-slider" class="block text-xs font-medium text-slate-500">Up/Down</label>
                            <input type="range" id="before-y-slider" min="0" max="1" step="0.01" value="0.5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" disabled>
                        </div>
                    </div>
                    <div id="after-slider-container" class="mt-4 hidden space-y-2">
                         <p class="text-sm font-medium text-slate-600">After Image</p>
                        <div>
                            <label for="after-zoom-slider" class="block text-xs font-medium text-slate-500">Zoom</label>
                            <input type="range" id="after-zoom-slider" min="1" max="3" step="0.01" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" disabled>
                        </div>
                        <div>
                            <label for="after-x-slider" class="block text-xs font-medium text-slate-500">Left/Right</label>
                            <input type="range" id="after-x-slider" min="0" max="1" step="0.01" value="0.5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" disabled>
                        </div>
                        <div>
                            <label for="after-y-slider" class="block text-xs font-medium text-slate-500">Up/Down</label>
                            <input type="range" id="after-y-slider" min="0" max="1" step="0.01" value="0.5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" disabled>
                        </div>
                    </div>
                </div>

                 <!-- Utilities -->
                <div class="mb-6 border-t pt-6">
                    <button id="reset-btn" class="w-full bg-slate-200 text-slate-700 font-bold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors">
                        Reset All
                    </button>
                </div>

                <!-- Export Button -->
                <button id="export-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed">
                    Generate & Export PNG
                </button>
            </section>

            <!-- Step 2: Preview -->
            <section class="bg-white p-6 rounded-xl shadow-lg border border-slate-200 flex flex-col items-center justify-center">
                <h3 class="text-xl font-semibold mb-4 w-full border-b pb-2">Preview</h3>
                <div id="canvas-container" class="w-full max-w-md aspect-square bg-slate-100 rounded-lg flex items-center justify-center">
                    <canvas id="canvas" class="max-w-full max-h-full rounded-md shadow-inner" aria-label="Image preview canvas"></canvas>
                </div>
                 <p id="preview-placeholder" class="text-slate-500 mt-4">Your generated image will appear here</p>
            </section>
        </main>

        <!-- Feature Comparison Section -->
        <section class="py-16 md:py-24 border-t mt-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-extrabold text-slate-900">A Tool Built for Professionals</h2>
                <p class="mt-4 max-w-xl mx-auto text-lg text-slate-600">Stop using generic tools. Start using a workflow designed for you.</p>
            </div>
            <div class="bg-white p-8 rounded-xl shadow-lg border border-slate-200 overflow-x-auto">
                <div class="grid grid-cols-3 gap-4 min-w-[600px]">
                    <div class="font-bold text-slate-800">Feature</div>
                    <div class="font-bold text-slate-800 text-center">Free</div>
                    <div class="font-bold text-slate-800 text-center text-indigo-600">Pro</div>

                    <!-- Feature Rows -->
                    <div class="col-span-3 border-b border-slate-200 my-2"></div>
                    
                    <div class="text-slate-600">Exports per month</div>
                    <div class="text-slate-600 text-center">3</div>
                    <div class="text-slate-900 font-bold text-center">Unlimited</div>

                    <div class="col-span-3 border-b border-slate-200 my-2"></div>

                    <div class="text-slate-600">Custom Fonts & Colors</div>
                    <div class="text-red-500 text-center font-bold">‚úñ</div>
                    <div class="text-green-500 text-center font-bold">‚úî</div>

                    <div class="col-span-3 border-b border-slate-200 my-2"></div>

                    <div class="text-slate-600">Center Logo Watermark</div>
                    <div class="text-red-500 text-center font-bold">‚úñ</div>
                    <div class="text-green-500 text-center font-bold">‚úî</div>

                    <div class="col-span-3 border-b border-slate-200 my-2"></div>
                    
                    <div class="text-slate-600">Compliant File Naming</div>
                    <div class="text-red-500 text-center font-bold">‚úñ</div>
                    <div class="text-green-500 text-center font-bold">‚úî</div>

                    <div class="col-span-3 border-b border-slate-200 my-2"></div>
                    
                    <div class="text-slate-600">"Key Differences" Box</div>
                    <div class="text-red-500 text-center font-bold">‚úñ</div>
                    <div class="text-green-500 text-center font-bold">‚úî</div>

                     <div class="col-span-3 border-b border-slate-200 my-2"></div>

                    <div class="text-slate-600">Saved Presets</div>
                    <div class="text-red-500 text-center font-bold">‚úñ</div>
                    <div class="text-green-500 text-center font-bold">‚úî</div>

                     <div class="col-span-3 border-b border-slate-200 my-2"></div>
                    
                    <div class="text-slate-600">"Made with" Branding</div>
                    <div class="text-green-500 text-center font-bold">‚úî</div>
                    <div class="text-slate-900 font-bold text-center">Removed</div>

                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center py-8 text-sm text-slate-500">
            <p>&copy; 2025 Before & After Pro. All rights reserved.</p>
        </footer>

    </div>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-900">Welcome</h3>
                    <button id="close-auth-modal" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Login Form -->
                <form id="login-form" class="space-y-4" onsubmit="handleMagicLinkLogin(event)">
                    <div>
                        <label for="login-email" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="login-email" name="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter your email">
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">
                        Send Magic Link
                    </button>
                    <p class="text-center text-sm text-gray-600">
                        We'll send you a secure link to sign in instantly
                    </p>
                    <p class="text-center text-sm text-gray-600">
                        Don't have an account? 
                        <button type="button" onclick="showSignupForm()" class="text-indigo-600 hover:text-indigo-500 font-medium">Sign up</button>
                    </p>
                </form>

                <!-- Signup Form -->
                <form id="signup-form" class="space-y-4 hidden" onsubmit="handleSignup(event)">
                    <div>
                        <label for="signup-email" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="signup-email" name="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="signup-password" class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="signup-password" name="password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="signup-confirm-password" class="block text-sm font-medium text-gray-700">Confirm Password</label>
                        <input type="password" id="signup-confirm-password" name="confirm-password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">
                        Create Account
                    </button>
                    <p class="text-center text-sm text-gray-600">
                        Already have an account? 
                        <button type="button" onclick="showLoginForm()" class="text-indigo-600 hover:text-indigo-500 font-medium">Sign in</button>
                    </p>
                </form>
            </div>
        </div>
    </div>

    <!-- Authentication Buttons (shown when not logged in) -->
    <div id="auth-container" class="fixed left-4 top-4 z-50 flex gap-2 items-center">
        <button id="login-btn" onclick="document.getElementById('auth-modal').classList.remove('hidden')" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg transition-colors">
            Login
        </button>
        <button id="signup-btn" onclick="showSignupForm()" class="bg-white hover:bg-gray-50 text-indigo-600 font-semibold px-4 py-2 rounded-lg border border-indigo-600 transition-colors">
            Sign Up
        </button>
    </div>

    <!-- User Info (shown when logged in) -->
    <div id="user-info" class="fixed left-4 top-4 z-50 flex gap-2 items-center hidden">
        <div class="flex items-center gap-2 bg-white rounded-lg shadow-lg px-3 py-2">
            <div id="user-avatar" class="w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center text-sm font-semibold"></div>
            <span id="user-email" class="text-sm text-gray-700"></span>
        </div>
        <button id="logout-btn" onclick="handleLogout()" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-lg transition-colors">
            Logout
        </button>
        <button onclick="checkMagicLinkAuth()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg transition-colors">
            Check Auth
        </button>
    </div>

    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Authentication JavaScript -->
    <script>
        // Simple authentication functions
        function showSignupForm() {
            document.getElementById('auth-modal').classList.remove('hidden');
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
        }
        
        function showLoginForm() {
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        }
        
        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
        }
        
        // Handle signup
        async function handleSignup(event) {
            event.preventDefault();
            
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }
            
            try {
                console.log('üîÑ Creating account for:', email);
                
                // Import Supabase client
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm');
                const supabase = createClient('https://ktikfagtsfpyjzymqzyi.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0aWtmYWd0c2ZweWp6eW1xenlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NjMyNTIsImV4cCI6MjA3MjIzOTI1Mn0.zDqc9tCBthwuv9C-dDgVvju4NCvHqExIqQjcmwF-Ikc');
                
                // Create user account
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (error) {
                    console.log('‚ùå Signup error:', error.message);
                    alert('Signup failed: ' + error.message);
                } else {
                    console.log('‚úÖ Account created successfully!');
                    
                    // Check if email confirmation is required
                    if (data.user && !data.user.email_confirmed_at) {
                        alert('Account created! Please check your email to verify your account. For testing, you can also try logging in directly.');
                    } else {
                        alert('Account created and verified! You can now log in.');
                    }
                    
                    closeAuthModal();
                }
            } catch (error) {
                console.log('‚ùå Signup catch error:', error.message);
                alert('Signup failed: ' + error.message);
            }
        }
        
        // Handle magic link login
        async function handleMagicLinkLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            
            try {
                console.log('üîÑ Sending magic link to:', email);
                
                // Import Supabase client
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm');
                const supabase = createClient('https://ktikfagtsfpyjzymqzyi.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0aWtmYWd0c2ZweWp6eW1xenlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NjMyNTIsImV4cCI6MjA3MjIzOTI1Mn0.zDqc9tCBthwuv9C-dDgVvju4NCvHqExIqQjcmwF-Ikc');
                
                // Send magic link
                const { data, error } = await supabase.auth.signInWithOtp({
                    email: email,
                    options: {
                        emailRedirectTo: 'https://www.beforeandafterco.com'
                    }
                });
                
                if (error) {
                    console.log('‚ùå Magic link error:', error.message);
                    alert('Failed to send magic link: ' + error.message);
                } else {
                    console.log('‚úÖ Magic link sent successfully!');
                    alert('Magic link sent! Check your email and click the link to sign in.');
                    closeAuthModal();
                }
            } catch (error) {
                console.log('‚ùå Magic link catch error:', error.message);
                alert('Failed to send magic link: ' + error.message);
            }
        }
        
        // Handle logout
        async function handleLogout() {
            try {
                console.log('üîÑ Logging out...');
                
                // Import Supabase client
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm');
                const supabase = createClient('https://ktikfagtsfpyjzymqzyi.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0aWtmYWd0c2ZweWp6eW1xenlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NjMyNTIsImV4cCI6MjA3MjIzOTI1Mn0.zDqc9tCBthwuv9C-dDgVvju4NCvHqExIqQjcmwF-Ikc');
                
                // Sign out user
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    console.log('‚ùå Logout error:', error.message);
                    alert('Logout failed: ' + error.message);
                } else {
                    console.log('‚úÖ Logout successful!');
                    
                    // Update UI to show logged out state
                    document.getElementById('user-info').classList.add('hidden');
                    document.getElementById('auth-container').classList.remove('hidden');
                    
                    // Reset Pro status to Free
                    updateProStatus(false);
                    
                    // Clear any stored data
                    localStorage.removeItem('last_used');
                    
                    alert('Logged out successfully!');
                }
            } catch (error) {
                console.log('‚ùå Logout catch error:', error.message);
                alert('Logout failed: ' + error.message);
            }
        }
        
        // Check subscription status
        async function checkSubscriptionStatus() {
            try {
                console.log('üîç Checking subscription status...');
                
                // Import Supabase client
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm');
                const supabase = createClient('https://ktikfagtsfpyjzymqzyi.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0aWtmYWd0c2ZweWp6eW1xenlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NjMyNTIsImV4cCI6MjA3MjIzOTI1Mn0.zDqc9tCBthwuv9C-dDgVvju4NCvHqExIqQjcmwF-Ikc');
                
                // Get current user
                const { data: { user } } = await supabase.auth.getUser();
                
                if (user) {
                    // Check if user has active subscription
                    const { data: subscription, error } = await supabase
                        .from('subscriptions')
                        .select('status, current_period_end')
                        .eq('user_id', user.id)
                        .eq('status', 'active')
                        .single();
                    
                    if (subscription && subscription.current_period_end) {
                        const endDate = new Date(subscription.current_period_end);
                        if (endDate > new Date()) {
                            // User has active Pro subscription
                            console.log('‚úÖ User has Pro subscription!');
                            updateProStatus(true);
                            return;
                        }
                    }
                }
                
                // User doesn't have Pro subscription
                console.log('‚ÑπÔ∏è User has Free plan');
                updateProStatus(false);
                
            } catch (error) {
                console.log('‚ùå Subscription check error:', error.message);
                updateProStatus(false);
            }
        }
        
        // Update Pro status in UI
        function updateProStatus(isPro) {
            const planPill = document.getElementById('plan-pill');
            const upgradeBtn = document.getElementById('upgrade-btn');
            
            if (isPro) {
                planPill.textContent = 'Pro Plan';
                planPill.classList.replace('bg-slate-200', 'bg-green-100');
                planPill.classList.replace('text-slate-700', 'text-green-800');
                upgradeBtn.classList.add('hidden');
                
                // Enable Pro features
                enableProFeatures();
            } else {
                planPill.textContent = 'Free Plan';
                planPill.classList.replace('bg-green-100', 'bg-slate-200');
                planPill.classList.replace('text-green-800', 'text-slate-700');
                upgradeBtn.classList.remove('hidden');
                
                // Disable Pro features
                disableProFeatures();
            }
        }
        
        // Enable Pro features
        function enableProFeatures() {
            const proFeatures = [
                document.getElementById('preset-section'),
                document.querySelector('input[name="patientName"]')?.parentElement,
                document.querySelector('input[name="brandColor"]')?.parentElement?.parentElement,
                document.querySelector('input[name="textColor"]')?.parentElement?.parentElement,
                document.querySelector('input[name="differencesBoxColor"]')?.parentElement?.parentElement,
                document.querySelector('textarea[name="differences"]')?.parentElement,
                document.querySelector('h4:nth-of-type(6)'), // Image Positioning Title
                document.getElementById('before-slider-container'),
                document.getElementById('after-slider-container'),
            ];
            
            proFeatures.forEach(el => {
                if (el) {
                    el.style.opacity = '1';
                    el.style.pointerEvents = 'auto';
                    el.title = '';
                }
            });
        }
        
        // Disable Pro features
        function disableProFeatures() {
            const proFeatures = [
                document.getElementById('preset-section'),
                document.querySelector('input[name="patientName"]')?.parentElement,
                document.querySelector('input[name="brandColor"]')?.parentElement?.parentElement,
                document.querySelector('input[name="textColor"]')?.parentElement?.parentElement,
                document.querySelector('input[name="differencesBoxColor"]')?.parentElement?.parentElement,
                document.querySelector('textarea[name="differences"]')?.parentElement,
                document.querySelector('h4:nth-of-type(6)'), // Image Positioning Title
                document.getElementById('before-slider-container'),
                document.getElementById('after-slider-container'),
            ];
            
            proFeatures.forEach(el => {
                if (el) {
                    el.style.opacity = '0.5';
                    el.style.pointerEvents = 'none';
                    el.title = 'Upgrade to Pro to use this feature.';
                }
            });
        }
        
        // Test Supabase connection
        async function testSupabaseConnection() {
            try {
                // Import Supabase directly from CDN for testing
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm');
                console.log('‚úÖ Supabase client loaded successfully!');
                
                // Test basic connection using your actual anon key
                const supabase = createClient('https://ktikfagtsfpyjzymqzyi.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0aWtmYWd0c2ZweWp6eW1xenlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NjMyNTIsImV4cCI6MjA3MjIzOTI1Mn0.zDqc9tCBthwuv9C-dDgVvju4NCvHqExIqQjcmwF-Ikc');
                
                // Test 1: Basic connection (should work)
                console.log('üîç Testing basic connection...');
                
                // Test 2: Try to get auth status (should work)
                try {
                    const { data: { user }, error: authError } = await supabase.auth.getUser();
                    if (authError) {
                        console.log('‚ùå Auth error:', authError.message);
                        console.log('üîç Full error object:', authError);
                    } else {
                        console.log('‚úÖ Auth connection successful!');
                    }
                } catch (authCatch) {
                    console.log('‚ùå Auth catch error:', authCatch.message);
                }
                
                // Test 3: Try to access users table (might fail due to RLS)
                try {
                    const { data, error } = await supabase.from('users').select('count').limit(1);
                    if (error) {
                        console.log('‚ùå Database query error:', error.message);
                        console.log('üí° This is expected - RLS policies are working');
                    } else {
                        console.log('‚úÖ Database query successful!');
                    }
                } catch (dbError) {
                    console.log('‚ùå Database access error:', dbError.message);
                }
            } catch (error) {
                console.log('‚ùå Module loading error:', error);
            }
        }
        
        // Close modal when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('close-auth-modal').addEventListener('click', closeAuthModal);
            document.getElementById('auth-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAuthModal();
                }
            });
            
            // Test Supabase connection
            testSupabaseConnection();
            
            // Check for magic link authentication
            checkMagicLinkAuth();
        });
        
        // Check if user is authenticated via magic link
        async function checkMagicLinkAuth() {
            try {
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm');
                const supabase = createClient('https://ktikfagtsfpyjzymqzyi.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0aWtmYWd0c2ZweWp6eW1xenlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NjMyNTIsImV4cCI6MjA3MjIzOTI1Mn0.zDqc9tCBthwuv9C-dDgVvju4NCvHqExIqQjcmwF-Ikc');
                
                // Get current session
                const { data: { session } } = await supabase.auth.getSession();
                
                if (session && session.user) {
                    console.log('‚úÖ User authenticated via magic link!');
                    
                    // Update UI to show logged in state
                    document.getElementById('auth-container').classList.add('hidden');
                    document.getElementById('user-info').classList.remove('hidden');
                    document.getElementById('user-email').textContent = session.user.email;
                    document.getElementById('user-avatar').textContent = session.user.email.charAt(0).toUpperCase();
                    
                    // Check subscription status
                    checkSubscriptionStatus();
                    
                    // Show welcome message
                    alert('Welcome back! You are now signed in.');
                }
            } catch (error) {
                console.log('‚ùå Magic link auth check error:', error.message);
            }
        }
    </script>
    
    <!-- External JavaScript -->
    <script src="app.js" defer></script>
    
    <!-- Fallback: Initialize basic app functionality -->
    <script>
        // Initialize basic app functionality if main app.js fails to load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if main app loaded
            setTimeout(() => {
                if (typeof BeforeAfterApp === 'undefined') {
                    console.log('‚ö†Ô∏è Main app not loaded, initializing basic functionality...');
                    initializeBasicApp();
                }
            }, 1000);
        });
        
        function initializeBasicApp() {
            // Basic image upload functionality
            const beforeUpload = document.getElementById('before-upload');
            const afterUpload = document.getElementById('after-upload');
            const logoUpload = document.getElementById('logo-upload');
            
            if (beforeUpload) {
                beforeUpload.addEventListener('change', function(e) {
                    console.log('Before image uploaded:', e.target.files[0]);
                    // Basic functionality - you can add image preview here
                });
            }
            
            if (afterUpload) {
                afterUpload.addEventListener('change', function(e) {
                    console.log('After image uploaded:', e.target.files[0]);
                    // Basic functionality - you can add image preview here
                });
            }
            
            if (logoUpload) {
                logoUpload.addEventListener('change', function(e) {
                    console.log('Logo uploaded:', e.target.files[0]);
                    // Basic functionality - you can add image preview here
                });
            }
            
            // Enable basic form functionality
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('change', function() {
                    console.log('Input changed:', this.name, this.value);
                });
            });
        }
    </script>
</body>
</html>
